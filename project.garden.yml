kind: Project
name: netbox
variables:
  # base_envname: ${slice((local.env.CI_REF_NAME_SLUG || replace(local.username, ".", "-")), '0', '11')}
  google_project_id: sandbox-20210927-xadnp6
  google_compute_region: us-central1
environments:
  - name: dev
providers:
  - name: terraform
    version: 1.0.5
    initRoot: "./terraform/application/netbox-infra"
    autoApply: true
    allowDestroy: false
    variables:
      project_id: ${var.google_project_id}
      region: ${var.google_compute_region}
      gcloud_get_credentials: true
      # namespace: ${providers.kubernetes.outputs.app-namespace}
  - name: kubernetes
    context: gke_${var.google_project_id}_${var.google_compute_region}_${providers.terraform.outputs.cluster_id}
    environments:
      - dev
    imagePullSecrets:
    - name: repo-access
      namespace: default
    deploymentRegistry:
      hostname: ${var.google_compute_region}-docker.pkg.dev
      namespace: ${var.google_project_id}/containers
    dependencies:
      - terraform
